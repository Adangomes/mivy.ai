<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYDI - JS PIZZARIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .cart-bounce { animation: bounce 0.3s ease-in-out; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        .pulse-animation { animation: pulse 2s infinite; }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes fadeIn {
  
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        .step-active { background: linear-gradient(135deg, #f97316, #ea580c); }
        .step-completed { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .status-pending { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .status-accepted { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .status-preparing { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .status-ready { background: linear-gradient(135deg, #10b981, #059669); }
        .status-delivered { background: linear-gradient(135deg, #6b7280, #4b5563); }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-800 to-gray-900 min-h-screen">
    <!-- App Selector -->
    <div class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex justify-center space-x-4">
                <button id="clientViewBtn" class="bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors">
                    📱 Visão do Cliente
                </button>
                <button id="restaurantViewBtn" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors">
                    🏪 Painel do Restaurante
                </button>
            </div>
        </div>
    </div>

    <!-- CLIENT VIEW -->
    <div id="clientView" class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-lg">
            <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div>
                        <h1 class="text-2xl font-bold text-orange-600">MYDI</h1>
                        <p class="text-lg font-semibold text-gray-800">JS PIZZARIA</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="cartBtn" class="relative bg-orange-500 text-white px-4 py-2 rounded-full hover:bg-orange-600 transition-colors flex items-center space-x-2">
                        <span>🛒</span>
                        <span>Carrinho</span>
                        <span id="cartCount" class="bg-red-500 text-white rounded-full px-2 py-1 text-xs ml-2 hidden">0</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-6xl mx-auto px-4 py-6">
            <!-- Categories -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-200">Categorias</h2>
                <div class="flex space-x-4 overflow-x-auto pb-2">
                    <button class="category-btn bg-orange-500 text-white px-6 py-2 rounded-full whitespace-nowrap hover:bg-orange-600 transition-colors" data-category="all">
                        Todos
                    </button>
                    <button class="category-btn bg-gray-200 text-gray-700 px-6 py-2 rounded-full whitespace-nowrap hover:bg-gray-300 transition-colors" data-category="burgers">
                        🍔 Hambúrguers
                    </button>
                    <button class="category-btn bg-gray-200 text-gray-700 px-6 py-2 rounded-full whitespace-nowrap hover:bg-gray-300 transition-colors" data-category="pizzas">
                        🍕 Pizzas
                    </button>
                    <button class="category-btn bg-gray-200 text-gray-700 px-6 py-2 rounded-full whitespace-nowrap hover:bg-gray-300 transition-colors" data-category="bebidas">
                        🥤 Bebidas
                    </button>
                </div>
            </div>

            <!-- Menu Items -->
            <div id="menuItems" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Items will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- RESTAURANT VIEW -->
    <div id="restaurantView" class="min-h-screen hidden">
        <!-- Header -->
        <header class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl">🏪</div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">MYDI - JS PIZZARIA</h1>
                            <p class="text-sm text-gray-600">Painel de Gestão de Pedidos</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="text-lg font-bold text-green-600" id="todayRevenue">R$ 0,00</div>
                            <div class="text-xs text-gray-500">Hoje</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-blue-600" id="todayOrders">0</div>
                            <div class="text-xs text-gray-500">Pedidos</div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-sm text-gray-600">Online</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 py-6">
            <!-- Quick Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Novos Pedidos</p>
                            <p class="text-2xl font-bold text-orange-600" id="newOrdersCount">0</p>
                        </div>
                        <div class="text-3xl">🔔</div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Em Preparo</p>
                            <p class="text-2xl font-bold text-blue-600" id="preparingCount">0</p>
                        </div>
                        <div class="text-3xl">👨‍🍳</div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Prontos</p>
                            <p class="text-2xl font-bold text-green-600" id="readyCount">0</p>
                        </div>
                        <div class="text-3xl">✅</div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Tempo Médio</p>
                            <p class="text-2xl font-bold text-purple-600" id="avgTime">25min</p>
                        </div>
                        <div class="text-3xl">⏱️</div>
                    </div>
                </div>
            </div>

            <!-- Order Filters -->
            <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                <div class="flex flex-wrap gap-3">
                    <button class="filter-btn bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors" data-status="all">
                        Todos os Pedidos
                    </button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors" data-status="pending">
                        🔔 Novos
                    </button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors" data-status="accepted">
                        📋 Aceitos
                    </button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors" data-status="preparing">
                        👨‍🍳 Preparando
                    </button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors" data-status="ready">
                        ✅ Prontos
                    </button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors" data-status="delivered">
                        🚚 Entregues
                    </button>
                </div>
            </div>

            <!-- Orders Grid -->
            <div id="ordersGrid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                <!-- Orders will be populated here -->
            </div>

            <!-- No Orders Message -->
            <div id="noOrdersMessage" class="text-center py-12 hidden">
                <div class="text-6xl mb-4">📋</div>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">Nenhum pedido encontrado</h3>
                <p class="text-gray-500">Os novos pedidos aparecerão aqui automaticamente</p>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full max-h-96 overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Seu Pedido</h3>
                        <button id="closeCart" class="text-gray-500 hover:text-gray-700">✕</button>
                    </div>
                    <div id="cartItems" class="space-y-4 mb-6">
                        <!-- Cart items will be populated here -->
                    </div>
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center mb-2">
                            <span>Subtotal:</span>
                            <span id="subtotal">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span>Taxa de entrega:</span>
                            <span id="deliveryFee">R$ 5,00</span>
                        </div>
                        <div class="flex justify-between items-center mb-4 text-lg font-bold">
                            <span>Total:</span>
                            <span id="cartTotal" class="text-orange-600">R$ 0,00</span>
                        </div>
                        <div class="space-y-3">
                            <button id="proceedCheckout" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors font-semibold">
                                Continuar Pedido
                            </button>
                            <button id="trackFromCart" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2">
                                <span>📍</span>
                                <span>Acompanhar Pedido</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold">Finalizar Pedido</h3>
                        <button id="closeCheckout" class="text-gray-500 hover:text-gray-700">✕</button>
                    </div>

                    <!-- Progress Steps -->
                    <div class="flex justify-between mb-8">
                        <div class="flex flex-col items-center">
                            <div id="step1" class="w-8 h-8 rounded-full step-active text-white flex items-center justify-center text-sm font-bold">1</div>
                            <span class="text-xs mt-1">Dados</span>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mt-4 mx-2"></div>
                        <div class="flex flex-col items-center">
                            <div id="step2" class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-sm font-bold">2</div>
                            <span class="text-xs mt-1">Entrega</span>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mt-4 mx-2"></div>
                        <div class="flex flex-col items-center">
                            <div id="step3" class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-sm font-bold">3</div>
                            <span class="text-xs mt-1">Pagamento</span>
                        </div>
                    </div>

                    <!-- Step 1: Customer Data -->
                    <div id="customerStep" class="fade-in">
                        <h4 class="font-semibold mb-4">Seus Dados</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <input type="text" id="customerName" placeholder="Nome completo" class="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <input type="tel" id="customerPhone" placeholder="Telefone" class="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <input type="email" id="customerEmail" placeholder="E-mail" class="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <input type="text" id="customerCPF" placeholder="CPF (opcional)" class="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                        </div>
                        <button id="nextToDelivery" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors">
                            Continuar para Entrega
                        </button>
                    </div>

                    <!-- Step 2: Delivery -->
                    <div id="deliveryStep" class="hidden">
                        <h4 class="font-semibold mb-4">Entrega</h4>
                        <div class="space-y-4 mb-6">
                            <div>
                                <label class="flex items-center space-x-2">
                                    <input type="radio" name="deliveryType" value="delivery" checked class="text-orange-500">
                                    <span>🚚 Entrega (R$ 5,00)</span>
                                </label>
                            </div>
                            <div>
                                <label class="flex items-center space-x-2">
                                    <input type="radio" name="deliveryType" value="pickup" class="text-orange-500">
                                    <span>🏪 Retirada no local (Grátis)</span>
                                </label>
                            </div>
                        </div>
                        <div id="addressSection">
                            <input type="text" id="customerAddress" placeholder="Endereço completo" class="w-full border rounded-lg px-3 py-2 mb-3 focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <input type="text" id="customerCEP" placeholder="CEP" class="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                                <input type="text" id="customerNumber" placeholder="Número" class="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                            </div>
                            <input type="text" id="customerComplement" placeholder="Complemento (opcional)" class="w-full border rounded-lg px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-orange-500">
                        </div>
                        <textarea id="orderNotes" placeholder="Observações especiais (opcional)" class="w-full border rounded-lg px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-orange-500" rows="3"></textarea>
                        <div class="flex space-x-3">
                            <button id="backToCustomer" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-colors">
                                Voltar
                            </button>
                            <button id="nextToPayment" class="flex-1 bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors">
                                Continuar para Pagamento
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Payment -->
                    <div id="paymentStep" class="hidden">
                        <h4 class="font-semibold mb-4">Pagamento</h4>
                        <div class="space-y-4 mb-6">
                            <div class="border rounded-lg p-4">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="paymentMethod" value="pix" checked class="text-orange-500">
                                    <span class="flex items-center space-x-2">
                                        <span>📱</span>
                                        <span>PIX (5% desconto)</span>
                                    </span>
                                </label>
                            </div>
                            <div class="border rounded-lg p-4">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="paymentMethod" value="card" class="text-orange-500">
                                    <span class="flex items-center space-x-2">
                                        <span>💳</span>
                                        <span>Cartão de Crédito/Débito</span>
                                    </span>
                                </label>
                            </div>
                            <div class="border rounded-lg p-4">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="paymentMethod" value="money" class="text-orange-500">
                                    <span class="flex items-center space-x-2">
                                        <span>💵</span>
                                        <span>Dinheiro na entrega</span>
                                    </span>
                                </label>
                            </div>
                        </div>
                        
                        <div id="moneyChangeSection" class="hidden mb-4">
                            <input type="number" id="moneyChange" placeholder="Troco para quanto?" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4 mb-6">
                            <h5 class="font-semibold mb-2">Resumo do Pedido</h5>
                            <div id="orderSummary"></div>
                            <div class="border-t pt-2 mt-2">
                                <div class="flex justify-between font-bold text-lg">
                                    <span>Total Final:</span>
                                    <span id="finalTotal" class="text-orange-600"></span>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-3">
                            <button id="backToDelivery" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-colors">
                                Voltar
                            </button>
                            <button id="finalizeOrder" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors font-semibold">
                                Finalizar Pedido
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6 text-center">
                <div class="text-6xl mb-4">✅</div>
                <h3 class="text-xl font-semibold mb-2">Pedido Enviado!</h3>
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <p class="text-sm text-gray-600 mb-2">Número do Pedido:</p>
                    <p id="orderNumber" class="text-lg font-bold text-orange-600">#12345</p>
                </div>
                <p class="text-gray-600 mb-4">Aguardando confirmação do restaurante...</p>
                <div class="space-y-2 mb-4">
                    <button id="trackOrderBtn" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        Acompanhar Pedido
                    </button>
                </div>
                <button id="closeConfirmation" class="bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- Order Details Modal (Restaurant) -->
    <div id="orderModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold">Detalhes do Pedido</h3>
                        <button id="closeModal" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                    </div>
                    
                    <div id="orderDetails">
                        <!-- Order details will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Tracking Modal -->
    <div id="trackingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold">Acompanhar Pedido</h3>
                        <button id="closeTracking" class="text-gray-500 hover:text-gray-700">✕</button>
                    </div>
                    
                    <div id="trackingContent">
                        <!-- Tracking content will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast Container -->
    <div id="toastContainer" class="fixed top-20 right-4 z-50 space-y-2">
        <!-- Toasts will be added here -->
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <div class="flex items-center justify-center space-x-2 mb-2">
                <span class="text-orange-500">💻</span>
                <p class="text-sm">Sistema desenvolvido por <span class="font-semibold text-orange-400">Adalberto Gomes</span></p>
            </div>
            <p class="text-xs text-gray-400">© 2024 MYDI - Todos os direitos reservados</p>
        </div>
    </footer>

    <script>
        // Global variables
        let currentView = 'client';
        let cart = [];
        let currentStep = 1;
        let customerData = {};
        let loyaltyPoints = 150;
        let currentFilter = 'all';
        let notificationSound = null;

        // Menu data
        const menuData = [
            { id: 1, name: "X-Burger Clássico", category: "burgers", price: 18.90, emoji: "🍔", description: "Hambúrguer, queijo, alface, tomate", stock: 15 },
            { id: 2, name: "X-Bacon", category: "burgers", price: 22.90, emoji: "🥓", description: "Hambúrguer, bacon, queijo, alface", stock: 12 },
            { id: 3, name: "X-Tudo", category: "burgers", price: 28.90, emoji: "🍔", description: "Hambúrguer, bacon, queijo, ovo, salada", stock: 8 },
            { id: 4, name: "Pizza Margherita", category: "pizzas", price: 32.90, emoji: "🍕", description: "Molho, mussarela, manjericão", stock: 10 },
            { id: 5, name: "Pizza Calabresa", category: "pizzas", price: 35.90, emoji: "🍕", description: "Molho, mussarela, calabresa, cebola", stock: 7 },
            { id: 6, name: "Coca-Cola", category: "bebidas", price: 6.90, emoji: "🥤", description: "Lata 350ml gelada", stock: 25 },
            { id: 7, name: "Suco Natural", category: "bebidas", price: 8.90, emoji: "🧃", description: "Laranja, limão ou maracujá", stock: 20 }
        ];

        // 🔥 INTEGRATION FUNCTIONS
        
        // Send order to restaurant system
        function sendOrderToRestaurant(orderData) {
            // Get existing restaurant orders
            let restaurantOrders = JSON.parse(localStorage.getItem('mydi_restaurant_orders') || '[]');
            
            // Add new order
            restaurantOrders.unshift(orderData);
            
            // Save to localStorage
            localStorage.setItem('mydi_restaurant_orders', JSON.stringify(restaurantOrders));
            
            // Trigger restaurant notification if restaurant view is active
            if (currentView === 'restaurant') {
                showToast(`🔔 Novo pedido #${orderData.id} recebido!`, 'warning', 8000);
                playNotificationSound();
                loadRestaurantOrders();
                updateRestaurantStats();
            }
            
            console.log('🔥 Pedido enviado para o restaurante:', orderData);
        }

        // Load restaurant orders
        function loadRestaurantOrders() {
            const orders = JSON.parse(localStorage.getItem('mydi_restaurant_orders') || '[]');
            renderRestaurantOrders(orders);
            return orders;
        }

        // Update order status from restaurant
        function updateOrderStatusFromRestaurant(orderId, newStatus) {
            let orders = JSON.parse(localStorage.getItem('mydi_restaurant_orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            
            if (order) {
                order.status = newStatus;
                
                // Update timestamp for status changes
                if (newStatus === 'accepted') {
                    order.acceptedAt = new Date().toISOString();
                } else if (newStatus === 'preparing') {
                    order.preparingAt = new Date().toISOString();
                } else if (newStatus === 'ready') {
                    order.readyAt = new Date().toISOString();
                } else if (newStatus === 'delivered') {
                    order.deliveredAt = new Date().toISOString();
                }
                
                // Save updated orders
                localStorage.setItem('mydi_restaurant_orders', JSON.stringify(orders));
                
                // Show success message
                const statusInfo = getStatusInfo(newStatus);
                showToast(`Pedido #${orderId} ${statusInfo.label.toLowerCase()}!`, 'success');
                
                // Simulate sending notification to customer
                setTimeout(() => {
                    console.log(`📱 Notificação enviada ao cliente: Pedido #${orderId} - ${statusInfo.label}`);
                }, 500);
                
                // Re-render orders and update stats
                loadRestaurantOrders();
                updateRestaurantStats();
            }
        }

        // CLIENT VIEW FUNCTIONS
        
        // Format currency
        function formatCurrency(value) {
            return `R$ ${value.toFixed(2).replace('.', ',')}`;
        }

        // Generate order number
        function generateOrderNumber() {
            return Math.floor(Math.random() * 90000) + 10000;
        }

        // Render menu items
        function renderMenuItems(category = 'all') {
            const filteredItems = category === 'all' ? menuData : menuData.filter(item => item.category === category);
            
            document.getElementById('menuItems').innerHTML = filteredItems.map(item => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                    <div class="flex">
                        <!-- Área para foto do produto -->
                        <div class="w-32 h-32 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center border-r border-gray-200">
                            <div class="text-center">
                                <div class="text-3xl mb-1">${item.emoji}</div>
                                <div class="text-xs text-gray-500 px-2">Adicione sua foto aqui</div>
                            </div>
                        </div>
                        
                        <!-- Conteúdo do produto -->
                        <div class="flex-1 p-4">
                            <h3 class="font-semibold text-lg mb-2 text-gray-800">${item.name}</h3>
                            <p class="text-gray-600 text-sm mb-2">${item.description}</p>
                            <p class="text-xs text-gray-500 mb-3">Estoque: ${item.stock} unidades</p>
                            <div class="flex justify-between items-center">
                                <span class="text-xl font-bold text-orange-600">${formatCurrency(item.price)}</span>
                                <button onclick="addToCart(${item.id})" 
                                    class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors ${item.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                    ${item.stock === 0 ? 'disabled' : ''}>
                                    ${item.stock === 0 ? 'Esgotado' : 'Adicionar'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Add to cart
        function addToCart(itemId) {
            const item = menuData.find(i => i.id === itemId);
            if (item.stock === 0) return;
            
            const existingItem = cart.find(i => i.id === itemId);
            const currentQuantity = existingItem ? existingItem.quantity : 0;
            
            if (currentQuantity >= item.stock) {
                alert(`Desculpe, temos apenas ${item.stock} unidades disponíveis.`);
                return;
            }
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ ...item, quantity: 1 });
            }
            
            updateCartUI();
            document.getElementById('cartBtn').classList.add('cart-bounce');
            setTimeout(() => document.getElementById('cartBtn').classList.remove('cart-bounce'), 300);
        }

        // Update cart UI
        function updateCartUI() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = 5.00;
            const total = subtotal + deliveryFee;
            
            if (totalItems > 0) {
                document.getElementById('cartCount').textContent = totalItems;
                document.getElementById('cartCount').classList.remove('hidden');
            } else {
                document.getElementById('cartCount').classList.add('hidden');
            }
            
            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('deliveryFee').textContent = formatCurrency(deliveryFee);
            document.getElementById('cartTotal').textContent = formatCurrency(total);
            
            document.getElementById('cartItems').innerHTML = cart.length === 0 ? 
                '<p class="text-gray-500 text-center">Seu carrinho está vazio</p>' :
                cart.map(item => `
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                        <div class="flex-1">
                            <h4 class="font-medium">${item.name}</h4>
                            <p class="text-sm text-gray-600">${formatCurrency(item.price)} cada</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateQuantity(${item.id}, -1)" class="bg-gray-200 text-gray-700 w-8 h-8 rounded-full hover:bg-gray-300">-</button>
                            <span class="font-medium">${item.quantity}</span>
                            <button onclick="updateQuantity(${item.id}, 1)" class="bg-orange-500 text-white w-8 h-8 rounded-full hover:bg-orange-600">+</button>
                        </div>
                    </div>
                `).join('');
        }

        // Update quantity
        function updateQuantity(itemId, change) {
            const item = cart.find(i => i.id === itemId);
            const menuItem = menuData.find(i => i.id === itemId);
            
            if (item) {
                const newQuantity = item.quantity + change;
                
                if (newQuantity > menuItem.stock) {
                    alert(`Desculpe, temos apenas ${menuItem.stock} unidades disponíveis.`);
                    return;
                }
                
                if (newQuantity <= 0) {
                    cart = cart.filter(i => i.id !== itemId);
                } else {
                    item.quantity = newQuantity;
                }
                updateCartUI();
            }
        }

        // Calculate final total with discounts
        function calculateFinalTotal() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked').value;
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            
            let deliveryFee = deliveryType === 'delivery' ? 5.00 : 0;
            let discount = 0;
            
            // PIX discount
            if (paymentMethod === 'pix') {
                discount = subtotal * 0.05; // 5% discount
            }
            
            return {
                subtotal,
                deliveryFee,
                discount,
                total: subtotal + deliveryFee - discount
            };
        }

        // Update order summary
        function updateOrderSummary() {
            const totals = calculateFinalTotal();
            
            let summaryHTML = `
                <div class="space-y-1 text-sm">
                    <div class="flex justify-between">
                        <span>Subtotal:</span>
                        <span>${formatCurrency(totals.subtotal)}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Entrega:</span>
                        <span>${formatCurrency(totals.deliveryFee)}</span>
                    </div>
            `;
            
            if (totals.discount > 0) {
                summaryHTML += `
                    <div class="flex justify-between text-green-600">
                        <span>Desconto PIX:</span>
                        <span>-${formatCurrency(totals.discount)}</span>
                    </div>
                `;
            }
            
            summaryHTML += '</div>';
            
            document.getElementById('orderSummary').innerHTML = summaryHTML;
            document.getElementById('finalTotal').textContent = formatCurrency(totals.total);
        }

        // RESTAURANT VIEW FUNCTIONS

        // Get status display info
        function getStatusInfo(status) {
            const statusMap = {
                pending: { label: "Novo Pedido", color: "status-pending", icon: "🔔", action: "Aceitar" },
                accepted: { label: "Aceito", color: "status-accepted", icon: "📋", action: "Iniciar Preparo" },
                preparing: { label: "Preparando", color: "status-preparing", icon: "👨‍🍳", action: "Marcar Pronto" },
                ready: { label: "Pronto", color: "status-ready", icon: "✅", action: "Marcar Entregue" },
                delivered: { label: "Entregue", color: "status-delivered", icon: "🚚", action: null }
            };
            return statusMap[status] || statusMap.pending;
        }

        // Format time ago
        function timeAgo(timestamp) {
            const now = new Date();
            const orderTime = new Date(timestamp);
            const diffMs = now - orderTime;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return "Agora mesmo";
            if (diffMins < 60) return `${diffMins}min atrás`;
            
            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `${diffHours}h atrás`;
            
            const diffDays = Math.floor(diffHours / 24);
            return `${diffDays}d atrás`;
        }

        // Render restaurant orders
        function renderRestaurantOrders(orders) {
            const filteredOrders = currentFilter === 'all' ? orders : orders.filter(o => o.status === currentFilter);
            const ordersGrid = document.getElementById('ordersGrid');
            const noOrdersMessage = document.getElementById('noOrdersMessage');
            
            if (filteredOrders.length === 0) {
                ordersGrid.innerHTML = '';
                noOrdersMessage.classList.remove('hidden');
                return;
            }
            
            noOrdersMessage.classList.add('hidden');
            
            ordersGrid.innerHTML = filteredOrders.map(order => {
                const statusInfo = getStatusInfo(order.status);
                const isUrgent = order.status === 'pending' && (Date.now() - new Date(order.timestamp)) > 600000; // 10 minutes
                
                return `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow fade-in ${isUrgent ? 'ring-2 ring-red-500 pulse-animation' : ''}">
                        <div class="${statusInfo.color} text-white p-4">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center space-x-2">
                                    <span class="text-xl">${statusInfo.icon}</span>
                                    <div>
                                        <h3 class="font-semibold">Pedido #${order.id}</h3>
                                        <p class="text-sm opacity-90">${statusInfo.label}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-lg">${formatCurrency(order.totals.total)}</p>
                                    <p class="text-xs opacity-90">${timeAgo(order.timestamp)}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4">
                            <div class="mb-3">
                                <h4 class="font-medium text-gray-800">${order.customer.name}</h4>
                                <p class="text-sm text-gray-600">${order.customer.phone}</p>
                                <p class="text-sm text-gray-600">${order.customer.address || 'Retirada no local'}</p>
                            </div>
                            
                            <div class="mb-3">
                                <p class="text-sm font-medium text-gray-700 mb-1">Itens:</p>
                                <div class="space-y-1">
                                    ${order.items.map(item => `
                                        <div class="flex justify-between text-sm">
                                            <span>${item.quantity}x ${item.name}</span>
                                            <span>${formatCurrency(item.price * item.quantity)}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-sm text-gray-600">
                                    ${order.paymentMethod === 'pix' ? '📱 PIX' : 
                                      order.paymentMethod === 'card' ? '💳 Cartão' : '💵 Dinheiro'}
                                </span>
                                <span class="text-sm text-gray-600">
                                    ${order.deliveryType === 'delivery' ? '🚚 Entrega' : '🏪 Retirada'}
                                </span>
                            </div>
                            
                            ${order.notes ? `
                                <div class="bg-yellow-50 border border-yellow-200 rounded p-2 mb-3">
                                    <p class="text-sm text-yellow-800"><strong>Obs:</strong> ${order.notes}</p>
                                </div>
                            ` : ''}
                            
                            <div class="flex space-x-2">
                                <button onclick="showOrderDetails(${order.id})" class="flex-1 bg-gray-100 text-gray-700 py-2 px-3 rounded hover:bg-gray-200 transition-colors text-sm">
                                    Ver Detalhes
                                </button>
                                ${statusInfo.action ? `
                                    <button onclick="nextStatus(${order.id})" class="flex-1 bg-blue-500 text-white py-2 px-3 rounded hover:bg-blue-600 transition-colors text-sm font-medium">
                                        ${statusInfo.action}
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Show order details modal
        function showOrderDetails(orderId) {
            const orders = JSON.parse(localStorage.getItem('mydi_restaurant_orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const statusInfo = getStatusInfo(order.status);
            
            document.getElementById('orderDetails').innerHTML = `
                <div class="space-y-6">
                    <!-- Order Header -->
                    <div class="${statusInfo.color} text-white p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="text-xl font-bold">Pedido #${order.id}</h4>
                                <p class="opacity-90">${statusInfo.label} • ${timeAgo(order.timestamp)}</p>
                            </div>
                            <div class="text-3xl">${statusInfo.icon}</div>
                        </div>
                    </div>
                    
                    <!-- Customer Info -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h5 class="font-semibold mb-2">Dados do Cliente</h5>
                        <div class="space-y-1 text-sm">
                            <p><strong>Nome:</strong> ${order.customer.name}</p>
                            <p><strong>Telefone:</strong> ${order.customer.phone}</p>
                            <p><strong>Email:</strong> ${order.customer.email || 'Não informado'}</p>
                            <p><strong>Endereço:</strong> ${order.customer.address || 'Retirada no local'}</p>
                        </div>
                    </div>
                    
                    <!-- Order Items -->
                    <div>
                        <h5 class="font-semibold mb-3">Itens do Pedido</h5>
                        <div class="space-y-2">
                            ${order.items.map(item => `
                                <div class="flex justify-between items-center bg-gray-50 p-3 rounded">
                                    <div>
                                        <p class="font-medium">${item.name}</p>
                                        <p class="text-sm text-gray-600">Quantidade: ${item.quantity}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">${formatCurrency(item.price * item.quantity)}</p>
                                        <p class="text-sm text-gray-600">${formatCurrency(item.price)} cada</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Order Summary -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h5 class="font-semibold mb-2">Resumo Financeiro</h5>
                        <div class="space-y-1 text-sm">
                            <div class="flex justify-between">
                                <span>Subtotal:</span>
                                <span>${formatCurrency(order.totals.subtotal)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Taxa de entrega:</span>
                                <span>${formatCurrency(order.totals.deliveryFee)}</span>
                            </div>
                            ${order.totals.discount > 0 ? `
                                <div class="flex justify-between text-green-600">
                                    <span>Desconto:</span>
                                    <span>-${formatCurrency(order.totals.discount)}</span>
                                </div>
                            ` : ''}
                            <div class="border-t pt-1 mt-2">
                                <div class="flex justify-between font-bold">
                                    <span>Total:</span>
                                    <span class="text-lg">${formatCurrency(order.totals.total)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Payment & Delivery -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-blue-50 rounded-lg p-3">
                            <h6 class="font-medium text-blue-800 mb-1">Pagamento</h6>
                            <p class="text-sm text-blue-700">
                                ${order.paymentMethod === 'pix' ? '📱 PIX' : 
                                  order.paymentMethod === 'card' ? '💳 Cartão' : '💵 Dinheiro'}
                            </p>
                        </div>
                        <div class="bg-green-50 rounded-lg p-3">
                            <h6 class="font-medium text-green-800 mb-1">Entrega</h6>
                            <p class="text-sm text-green-700">
                                ${order.deliveryType === 'delivery' ? '🚚 Entrega' : '🏪 Retirada'}
                            </p>
                        </div>
                    </div>
                    
                    ${order.notes ? `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                            <h6 class="font-medium text-yellow-800 mb-1">Observações</h6>
                            <p class="text-sm text-yellow-700">${order.notes}</p>
                        </div>
                    ` : ''}
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-3 pt-4 border-t">
                        <button onclick="callCustomer('${order.customer.phone}')" class="flex-1 bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 transition-colors">
                            📞 Ligar para Cliente
                        </button>
                        ${statusInfo.action ? `
                            <button onclick="nextStatus(${order.id}); closeModal();" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition-colors">
                                ${statusInfo.action}
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('orderModal').classList.remove('hidden');
        }

        // Move to next status
        function nextStatus(orderId) {
            const statusFlow = {
                'pending': 'accepted',
                'accepted': 'preparing', 
                'preparing': 'ready',
                'ready': 'delivered'
            };
            
            const orders = JSON.parse(localStorage.getItem('mydi_restaurant_orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const nextStatus = statusFlow[order.status];
            if (nextStatus) {
                updateOrderStatusFromRestaurant(orderId, nextStatus);
            }
        }

        // Update restaurant statistics
        function updateRestaurantStats() {
            const orders = JSON.parse(localStorage.getItem('mydi_restaurant_orders') || '[]');
            const today = new Date().toDateString();
            const todayOrders = orders.filter(o => new Date(o.timestamp).toDateString() === today);
            
            const newOrders = orders.filter(o => o.status === 'pending').length;
            const preparing = orders.filter(o => o.status === 'preparing').length;
            const ready = orders.filter(o => o.status === 'ready').length;
            
            const todayRevenue = todayOrders.reduce((sum, o) => sum + o.totals.total, 0);
            
            document.getElementById('newOrdersCount').textContent = newOrders;
            document.getElementById('preparingCount').textContent = preparing;
            document.getElementById('readyCount').textContent = ready;
            document.getElementById('todayOrders').textContent = todayOrders.length;
            document.getElementById('todayRevenue').textContent = formatCurrency(todayRevenue);
        }

        // Call customer (simulate)
        function callCustomer(phone) {
            showToast(`Ligando para ${phone}...`, 'info');
            console.log(`📞 Iniciando ligação para: ${phone}`);
        }

        // Track order function
        function trackOrder(orderId) {
            const orders = JSON.parse(localStorage.getItem('mydi_restaurant_orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            
            if (!order) {
                showToast('Pedido não encontrado', 'error');
                return;
            }
            
            const statusInfo = getStatusInfo(order.status);
            const statusSteps = [
                { key: 'pending', label: 'Pedido Recebido', icon: '🔔', time: order.timestamp },
                { key: 'accepted', label: 'Pedido Aceito', icon: '✅', time: order.acceptedAt },
                { key: 'preparing', label: 'Em Preparo', icon: '👨‍🍳', time: order.preparingAt },
                { key: 'ready', label: 'Pronto para Entrega', icon: '🎉', time: order.readyAt },
                { key: 'delivered', label: 'Entregue', icon: '🚚', time: order.deliveredAt }
            ];
            
            const currentStepIndex = statusSteps.findIndex(step => step.key === order.status);
            
            document.getElementById('trackingContent').innerHTML = `
                <div class="space-y-6">
                    <!-- Order Info -->
                    <div class="text-center">
                        <div class="text-4xl mb-2">${statusInfo.icon}</div>
                        <h4 class="text-lg font-semibold">Pedido #${order.id}</h4>
                        <p class="text-gray-600">${statusInfo.label}</p>
                        <p class="text-sm text-gray-500 mt-1">Feito ${timeAgo(order.timestamp)}</p>
                    </div>
                    
                    <!-- Progress Steps -->
                    <div class="space-y-4">
                        ${statusSteps.map((step, index) => {
                            const isCompleted = index <= currentStepIndex;
                            const isCurrent = index === currentStepIndex;
                            
                            return `
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm ${
                                        isCompleted ? 'bg-green-500 text-white' : 
                                        'bg-gray-200 text-gray-500'
                                    }">
                                        ${isCompleted ? '✓' : index + 1}
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-medium ${isCurrent ? 'text-orange-600' : isCompleted ? 'text-green-600' : 'text-gray-500'}">
                                            ${step.icon} ${step.label}
                                        </p>
                                        ${step.time ? `
                                            <p class="text-xs text-gray-500">${timeAgo(step.time)}</p>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <!-- Order Details -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h5 class="font-medium mb-2">Detalhes do Pedido</h5>
                        <div class="space-y-1 text-sm">
                            ${order.items.map(item => `
                                <div class="flex justify-between">
                                    <span>${item.quantity}x ${item.name}</span>
                                    <span>${formatCurrency(item.price * item.quantity)}</span>
                                </div>
                            `).join('')}
                            <div class="border-t pt-1 mt-2">
                                <div class="flex justify-between font-medium">
                                    <span>Total:</span>
                                    <span>${formatCurrency(order.totals.total)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Estimated Time -->
                    ${order.status !== 'delivered' ? `
                        <div class="text-center bg-blue-50 rounded-lg p-3">
                            <p class="text-sm text-blue-700">
                                ⏱️ Tempo estimado: ${order.estimatedTime || 25} minutos
                            </p>
                        </div>
                    ` : ''}
                    
                    <!-- Contact Info -->
                    <div class="text-center">
                        <p class="text-sm text-gray-600 mb-2">Precisa de ajuda?</p>
                        <button onclick="callRestaurant()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm">
                            📞 Ligar para o Restaurante
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('trackingModal').classList.remove('hidden');
        }

        // Call restaurant function
        function callRestaurant() {
            showToast('Ligando para o restaurante...', 'info');
            console.log('📞 Ligando para: (11) 99999-9999');
        }

        // SHARED FUNCTIONS

        // Show notification toast
        function showToast(message, type = 'info', duration = 5000) {
            const toast = document.createElement('div');
            toast.className = `slide-in p-4 rounded-lg shadow-lg text-white max-w-sm transform transition-transform duration-300 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-orange-500' :
                'bg-blue-500'
            }`;
            
            toast.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span>${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            // Auto remove
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, duration);
        }

        // Initialize notification sound
        function initializeSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                return function playNotificationSound() {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                };
            } catch (e) {
                return () => {}; // Fallback if audio not supported
            }
        }

        function playNotificationSound() {
            if (notificationSound) {
                notificationSound();
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('orderModal').classList.add('hidden');
        }

        // Reset checkout form
        function resetCheckoutForm() {
            currentStep = 1;
            document.getElementById('customerStep').classList.remove('hidden');
            document.getElementById('deliveryStep').classList.add('hidden');
            document.getElementById('paymentStep').classList.add('hidden');
            
            // Reset step indicators
            document.getElementById('step1').classList.add('step-active');
            document.getElementById('step1').classList.remove('step-completed');
            document.getElementById('step2').classList.remove('step-active', 'step-completed');
            document.getElementById('step3').classList.remove('step-active', 'step-completed');
            
            // Clear form fields
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('customerCEP').value = '';
            document.getElementById('customerNumber').value = '';
            document.getElementById('customerComplement').value = '';
            document.getElementById('orderNotes').value = '';
            document.getElementById('moneyChange').value = '';
            
            // Reset radio buttons
            document.querySelector('input[name="deliveryType"][value="delivery"]').checked = true;
            document.querySelector('input[name="paymentMethod"][value="pix"]').checked = true;
            document.getElementById('moneyChangeSection').classList.add('hidden');
        }

        // VIEW SWITCHING
        document.getElementById('clientViewBtn').addEventListener('click', () => {
            currentView = 'client';
            document.getElementById('clientView').classList.remove('hidden');
            document.getElementById('restaurantView').classList.add('hidden');
            
            // Update button styles
            document.getElementById('clientViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('clientViewBtn').classList.add('bg-orange-500', 'text-white');
            document.getElementById('restaurantViewBtn').classList.remove('bg-orange-500', 'text-white');
            document.getElementById('restaurantViewBtn').classList.add('bg-gray-200', 'text-gray-700');
            
            renderMenuItems();
            updateCartUI();
        });

        document.getElementById('restaurantViewBtn').addEventListener('click', () => {
            currentView = 'restaurant';
            document.getElementById('clientView').classList.add('hidden');
            document.getElementById('restaurantView').classList.remove('hidden');
            
            // Update button styles
            document.getElementById('restaurantViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('restaurantViewBtn').classList.add('bg-orange-500', 'text-white');
            document.getElementById('clientViewBtn').classList.remove('bg-orange-500', 'text-white');
            document.getElementById('clientViewBtn').classList.add('bg-gray-200', 'text-gray-700');
            
            loadRestaurantOrders();
            updateRestaurantStats();
        });

        // CLIENT EVENT LISTENERS

        // Category filtering
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-btn').forEach(b => {
                    b.classList.remove('bg-orange-500', 'text-white');
                    b.classList.add('bg-gray-200', 'text-gray-700');
                });
                btn.classList.remove('bg-gray-200', 'text-gray-700');
                btn.classList.add('bg-orange-500', 'text-white');
                
                const category = btn.dataset.category;
                renderMenuItems(category);
            });
        });

        // Cart modal
        document.getElementById('cartBtn').addEventListener('click', () => {
            document.getElementById('cartModal').classList.remove('hidden');
        });

        document.getElementById('proceedCheckout').addEventListener('click', () => {
            if (cart.length === 0) return;
            document.getElementById('cartModal').classList.add('hidden');
            document.getElementById('checkoutModal').classList.remove('hidden');
        });

        // Checkout steps
        document.getElementById('nextToDelivery').addEventListener('click', () => {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            
            if (!name || !phone) {
                alert('Por favor, preencha pelo menos o nome e telefone.');
                return;
            }
            
            customerData = {
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value,
                cpf: document.getElementById('customerCPF').value
            };
            
            document.getElementById('customerStep').classList.add('hidden');
            document.getElementById('deliveryStep').classList.remove('hidden');
            document.getElementById('step1').classList.remove('step-active');
            document.getElementById('step1').classList.add('step-completed');
            document.getElementById('step2').classList.add('step-active');
            currentStep = 2;
        });

        document.getElementById('nextToPayment').addEventListener('click', () => {
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked').value;
            
            if (deliveryType === 'delivery') {
                const address = document.getElementById('customerAddress').value;
                const cep = document.getElementById('customerCEP').value;
                
                if (!address || !cep) {
                    alert('Por favor, preencha o endereço completo para entrega.');
                    return;
                }
            }
            
            customerData.deliveryType = deliveryType;
            customerData.address = document.getElementById('customerAddress').value;
            customerData.cep = document.getElementById('customerCEP').value;
            customerData.number = document.getElementById('customerNumber').value;
            customerData.complement = document.getElementById('customerComplement').value;
            
            document.getElementById('deliveryStep').classList.add('hidden');
            document.getElementById('paymentStep').classList.remove('hidden');
            document.getElementById('step2').classList.remove('step-active');
            document.getElementById('step2').classList.add('step-completed');
            document.getElementById('step3').classList.add('step-active');
            currentStep = 3;
            
            updateOrderSummary();
        });

        // Back buttons
        document.getElementById('backToCustomer').addEventListener('click', () => {
            document.getElementById('deliveryStep').classList.add('hidden');
            document.getElementById('customerStep').classList.remove('hidden');
            document.getElementById('step2').classList.remove('step-active');
            document.getElementById('step1').classList.remove('step-completed');
            document.getElementById('step1').classList.add('step-active');
            currentStep = 1;
        });

        document.getElementById('backToDelivery').addEventListener('click', () => {
            document.getElementById('paymentStep').classList.add('hidden');
            document.getElementById('deliveryStep').classList.remove('hidden');
            document.getElementById('step3').classList.remove('step-active');
            document.getElementById('step2').classList.remove('step-completed');
            document.getElementById('step2').classList.add('step-active');
            currentStep = 2;
        });

        // Payment method change
        document.addEventListener('change', (e) => {
            if (e.target.name === 'paymentMethod') {
                updateOrderSummary();
                
                const moneySection = document.getElementById('moneyChangeSection');
                if (e.target.value === 'money') {
                    moneySection.classList.remove('hidden');
                } else {
                    moneySection.classList.add('hidden');
                }
            }
            
            if (e.target.name === 'deliveryType') {
                const addressSection = document.getElementById('addressSection');
                if (e.target.value === 'delivery') {
                    addressSection.style.display = 'block';
                } else {
                    addressSection.style.display = 'none';
                }
                updateOrderSummary();
            }
        });

        // Finalize order
        document.getElementById('finalizeOrder').addEventListener('click', () => {
            // Validate payment method specific fields
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            
            if (paymentMethod === 'money') {
                const changeValue = document.getElementById('moneyChange').value;
                const total = calculateFinalTotal().total;
                
                if (changeValue && parseFloat(changeValue) < total) {
                    alert('O valor para troco deve ser maior que o total do pedido.');
                    return;
                }
            }
            
            // Show loading state
            const finalizeBtn = document.getElementById('finalizeOrder');
            const originalText = finalizeBtn.textContent;
            finalizeBtn.textContent = 'Processando...';
            finalizeBtn.disabled = true;
            
            setTimeout(() => {
                const totals = calculateFinalTotal();
                const orderNumber = generateOrderNumber();
                
                const orderData = {
                    id: orderNumber,
                    orderNumber,
                    customer: customerData,
                    items: [...cart],
                    totals,
                    paymentMethod,
                    deliveryType: customerData.deliveryType,
                    moneyChange: document.getElementById('moneyChange').value || null,
                    timestamp: new Date().toISOString(),
                    status: 'pending', // Start as pending for restaurant to accept
                    estimatedTime: Math.floor(Math.random() * 20) + 25,
                    notes: document.getElementById('orderNotes').value || ''
                };
                
                // 🔥 INTEGRATION: Send order to restaurant system
                sendOrderToRestaurant(orderData);
                
                // Show confirmation
                document.getElementById('orderNumber').textContent = `#${orderNumber}`;
                document.getElementById('checkoutModal').classList.add('hidden');
                document.getElementById('confirmationModal').classList.remove('hidden');
                
                // Store current order ID for tracking
                window.currentOrderId = orderNumber;
                
                // Clear cart and reset form
                cart = [];
                updateCartUI();
                resetCheckoutForm();
                
                // Reset button
                finalizeBtn.textContent = originalText;
                finalizeBtn.disabled = false;
                
                console.log('🔥 Pedido enviado para o restaurante:', orderData);
            }, 1500);
        });

        // RESTAURANT EVENT LISTENERS

        // Filter orders
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active filter button
                document.querySelectorAll('.filter-btn').forEach(b => {
                    b.classList.remove('bg-orange-500', 'text-white');
                    b.classList.add('bg-gray-200', 'text-gray-700');
                });
                btn.classList.remove('bg-gray-200', 'text-gray-700');
                btn.classList.add('bg-orange-500', 'text-white');
                
                // Update filter and re-render
                currentFilter = btn.dataset.status;
                loadRestaurantOrders();
            });
        });

        // MODAL EVENT LISTENERS

        // Close modal buttons
        document.getElementById('closeCart').addEventListener('click', () => {
            document.getElementById('cartModal').classList.add('hidden');
        });

        document.getElementById('closeCheckout').addEventListener('click', () => {
            document.getElementById('checkoutModal').classList.add('hidden');
        });

        document.getElementById('closeConfirmation').addEventListener('click', () => {
            document.getElementById('confirmationModal').classList.add('hidden');
        });

        document.getElementById('closeModal').addEventListener('click', closeModal);

        document.getElementById('closeTracking').addEventListener('click', () => {
            document.getElementById('trackingModal').classList.add('hidden');
        });

        document.getElementById('trackOrderBtn').addEventListener('click', () => {
            if (window.currentOrderId) {
                trackOrder(window.currentOrderId);
                document.getElementById('confirmationModal').classList.add('hidden');
            }
        });

        document.getElementById('trackFromCart').addEventListener('click', () => {
            if (window.currentOrderId) {
                trackOrder(window.currentOrderId);
                document.getElementById('cartModal').classList.add('hidden');
            } else {
                showToast('Você ainda não fez nenhum pedido', 'info');
            }
        });

        // Close modals on outside click
        [document.getElementById('cartModal'), document.getElementById('checkoutModal'), 
         document.getElementById('confirmationModal'), document.getElementById('orderModal'),
         document.getElementById('trackingModal')].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.add('hidden');
            });
        });

        // INITIALIZATION
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize sound
            notificationSound = initializeSound();
            
            // Initial render
            renderMenuItems();
            updateCartUI();
            
            console.log('🔥 Sistema integrado inicializado!');
            console.log('📱 Visão do cliente ativa');
            console.log('🏪 Painel do restaurante pronto para receber pedidos');
        });

        // Make functions globally available
        window.addToCart = addToCart;
        window.updateQuantity = updateQuantity;
        window.showOrderDetails = showOrderDetails;
        window.closeModal = closeModal;
        window.callCustomer = callCustomer;
        window.nextStatus = nextStatus;
        window.trackOrder = trackOrder;
        window.callRestaurant = callRestaurant;
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9794a8e002dea438',t:'MTc1Njg5NjM0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>







